<!--pages/todoList/todoList.wxml-->
<block class="main">
  <block class="todos" wx:for="{{todos}}" wx:key="id">
    <view mark:idx="{{index}}" mark:id="{{item.id}}" class="todo {{stats[index].animB}}" bind:touchstart="handleTodoClick" bind:touchend="handleTodoClickOver"><text>{{item.content}}</text>
      <view class="todo-ops {{stats[index].animC}} {{stats[index].selected}}">
        <view class="modify-btn todo-op {{stats[index].animD === 'modify' ? 'animD' : ''}}" mark:op="modify" bind:tap="handleTodoOp" bind:touchstart="handleTodoOpClick" bind:touchend="handleTodoOpClickOver">
          <text>✏️</text>
        </view>
        <view class="remove-btn todo-op {{stats[index].animD === 'remove' ? 'animD' : ''}}" mark:op="remove" bind:tap="handleTodoOp" bind:touchstart="handleTodoOpClick" bind:touchend="handleTodoOpClickOver">
          <text>🗑️</text>
        </view>
        <view class="done-btn todo-op {{stats[index].animD === 'done' ? 'animD' : ''}}" mark:op="done" bind:tap="handleTodoOp" bind:touchstart="handleTodoOpClick" bind:touchend="handleTodoOpClickOver">
          <text>✓</text>
        </view>
      </view>
    </view>
  </block>
</block>
<mp-tabbar reactive="{{false}}" ext-class="tabbar" style="position:fixed;bottom:0;width:100%;left:0;right:0;" list="{{list}}" bindchange="tabChange"></mp-tabbar>
<view class="fab {{animA}}" bind:tap="addTodo" bind:touchstart="startClickAnimA" bind:touchend="endClickAnimA">
  <text>+ 添加</text>
</view>
<view class="{{animA}}">
  <text>调试工具========================</text>
</view>
<view class="fab1 {{animA}}" bind:tap="aitest" bind:touchstart="startClickAnimA" bind:touchend="endClickAnimA">
  <text>aitest</text>
</view>
<view class="fab1 {{animA}}" bind:tap="saveTodo" bind:touchstart="startClickAnimA" bind:touchend="endClickAnimA">
  <text>save</text>
</view>
<view class="fab1 {{animA}}" bind:tap="loadTodo" bind:touchstart="startClickAnimA" bind:touchend="endClickAnimA">
  <text>load</text>
</view>
<view class="fab1 {{animA}}" bind:tap="restart" bind:touchstart="startClickAnimA" bind:touchend="endClickAnimA">
  <text>restart</text>
</view>
<mp-half-screen-dialog extClass="hfsheet {{animEc === 'show'?'animEc':''}}" bindbuttontap="hfbtntap" bindclose="hfclose" show="{{showTodoSheet}}" maskClosable="{{true}}" title="添加新待办" buttons="{{buttons}}">
  <view slot="desc" style="padding:0;">
    <scroll-view class="{{inputing==true?'inputing-parent':'noninputing-parent'}}" scroll-y="true">
      <view class="generateView">
        <view wx:if="{{showTodoSheet}}" class="inputView {{animEa === 'input'?'animEa':''}} {{animEb === 'input'?'animEb':''}}  {{inputing==true?'inputing':''}}">
          <text bind:tap="test">Tips: 试试输入一段话，让小程序为你生成待办清单</text>
          <textarea class="weui-textarea" show-confirm-bar="{{false}}" placeholder="输入待办事项....." bindinput="bindinput" bindblur="bindblur" bindfocus="bindfocus"></textarea>
        </view>
        <view class="resultView {{animEa === 'result'?'animEa':''}} {{animEb === 'result'?'animEb':''}}" style="margin-top: -38px;">
          <mp-cells title="选择要添加的待办事项">
            <mp-checkbox-group prop="checkbox" multi="{{true}}" bindchange="bindchange">
              <mp-checkbox wx:for="{{generatedTodos}}" wx:key="value" label="{{item.name}}" value="{{item.value}}" checked="{{item.checked}}"></mp-checkbox>
            </mp-checkbox-group>
          </mp-cells>
        </view>
        <view class="loadingView {{animEa === 'loading'?'animEa':''}} {{animEb === 'loading'?'animEb':''}}">
          <mp-loading type="dot-gray" show="{{true}}" style="display: {{generateStatus !== 'failed'?'unset':'none'}};"></mp-loading>
          <view class="icon-box" style="display: {{generateStatus === 'failed'?'flex':'none'}};">
            <i role="img" title="等待" class="weui-icon-info weui-icon_msg"></i>
            <view class="icon-box-ctn">
              <view class="icon-box-title">提示</view>
              <view class="icon-box-desc">请更换表述后重试</view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</mp-half-screen-dialog>